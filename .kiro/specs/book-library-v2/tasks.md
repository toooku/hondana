# 蔵書管理アプリケーション v2 - 実装計画

- [x] 1. プロジェクト構造とコア依存関係の設定
  - 既存のv1プロジェクトをベースに、v2用の新しいモジュールを追加
  - 新しい依存関係をインストール（pyzbar、opencv-python、markdown、Flask）
  - pyproject.tomlを更新
  - _要件: 1.1, 2.1, 3.1, 4.1, 5.1_

- [x] 2. データモデルの拡張
  - [x] 2.1 Bookクラスを拡張（cover_url、statusフィールドを追加）
    - _要件: 2.1, 3.1_
  
  - [x] 2.2 StatusHistoryクラスを実装
    - _要件: 2.3_
  
  - [x] 2.3 Impressionクラスを簡略化（file_pathフィールドに変更）
    - _要件: 4.1_
  
  - [x]* 2.4 データモデルのプロパティテストを実装
    - **プロパティ1: 新規本のデフォルトステータス**
    - **検証: 要件2.1**

- [x] 3. ステータス管理サービスの実装
  - [x] 3.1 StatusServiceクラスを実装
    - set_status(book_id: str, status: str)メソッド
    - get_status(book_id: str)メソッド
    - get_status_history(book_id: str)メソッド
    - get_books_by_status(status: str)メソッド
    - _要件: 2.2, 2.3, 2.4_
  
  - [x]* 3.2 ステータス管理のプロパティテストを実装
    - **プロパティ2: ステータス変更の永続化**
    - **検証: 要件2.2**
  
  - [x]* 3.3 ステータス管理のプロパティテストを実装
    - **プロパティ3: ステータス変更履歴の記録**
    - **検証: 要件2.3**
  
  - [x]* 3.4 ステータス管理のプロパティテストを実装
    - **プロパティ4: ステータスごとの本の分類**
    - **検証: 要件2.4**

- [x] 4. バーコード読み取り機能の実装
  - [x] 4.1 BarcodeScannerクラスを実装
    - start_camera()メソッド
    - scan_barcode()メソッド
    - stop_camera()メソッド
    - _要件: 1.1, 1.2, 1.3_
  
  - [x]* 4.2 バーコード読み取りのプロパティテストを実装
    - **プロパティ11: バーコード読み取りの正確性**
    - **検証: 要件1.2**

- [x] 5. 書影管理機能の実装
  - [x] 5.1 OpenBDClientを拡張して書影URLを取得
    - fetch_cover_url(isbn: str)メソッド
    - デフォルト画像の処理
    - _要件: 3.1, 3.2_
  
  - [x] 5.2 BookServiceを拡張して書影URLを保存
    - _要件: 3.1_
  
  - [x]* 5.3 書影管理のプロパティテストを実装
    - **プロパティ5: 書影URLの取得と保存**
    - **検証: 要件3.1, 3.2**

- [x] 6. Markdownベースの感想管理の実装
  - [x] 6.1 ImpressionServiceを拡張してMarkdownファイルを管理
    - create_impression(book_id: str, content: str)メソッド
    - get_impression(book_id: str)メソッド
    - update_impression(book_id: str, content: str)メソッド
    - delete_impression(book_id: str)メソッド
    - _要件: 4.1, 4.2, 4.3_
  
  - [x]* 6.2 感想ファイル管理のプロパティテストを実装
    - **プロパティ8: 感想ファイルのラウンドトリップ**
    - **検証: 要件4.1, 4.2**
  
  - [x]* 6.3 感想ファイル管理のプロパティテストを実装
    - **プロパティ9: 感想ファイルの更新**
    - **検証: 要件4.3**

- [x] 7. Markdown to HTML変換機能の実装
  - [x] 7.1 MarkdownConverterクラスを実装
    - convert_to_html(markdown_text: str)メソッド
    - _要件: 4.4_
  
  - [x]* 7.2 Markdown変換のプロパティテストを実装
    - **プロパティ10: Markdownから HTMLへの変換**
    - **検証: 要件4.4**

- [x] 8. 静的サイト生成の拡張
  - [x] 8.1 StaticSiteGeneratorを拡張
    - ステータスごとの本分類表示
    - 書影の表示
    - Markdown感想のHTML変換と表示
    - _要件: 2.4, 3.3, 3.4, 4.4_
  
  - [x]* 8.2 静的サイト生成のプロパティテストを実装
    - **プロパティ6: 生成されたHTMLに書影が含まれる**
    - **検証: 要件3.3**
  
  - [x]* 8.3 静的サイト生成のプロパティテストを実装
    - **プロパティ7: 本一覧ページに書影が含まれる**
    - **検証: 要件3.4**
  
  - [x]* 8.4 静的サイト生成のプロパティテストを実装
    - **プロパティ11: 生成されたサイトにすべての機能が含まれる**
    - **検証: 要件5.2**

- [x] 9. Webインターフェースの実装
  - [x] 9.1 Flaskアプリケーションのセットアップ
    - ホームページ、本一覧、本詳細ページ
    - _要件: 5.1, 5.3_
  
  - [x] 9.2 バーコード読み取り画面の実装
    - Webカメラアクセス
    - リアルタイムバーコード認識
    - _要件: 1.1, 1.2_
  
  - [x] 9.3 ステータス管理UI の実装
    - ステータス変更フォーム
    - ステータス履歴表示
    - _要件: 2.2, 2.3_
  
  - [x] 9.4 感想編集UIの実装
    - Markdownエディタ
    - プレビュー機能
    - _要件: 4.1, 4.3_

- [x] 10. CLIの拡張
  - [x] 10.1 バーコード読み取りコマンドを追加
    - scan-barcode: バーコード読み取りを開始
    - _要件: 1.1, 1.2_
  
  - [x] 10.2 ステータス管理コマンドを追加
    - set-status <book_id> <status>: ステータスを変更
    - show-status <book_id>: ステータスを表示
    - list-by-status <status>: ステータスごとに本を表示
    - _要件: 2.2, 2.3, 2.4_
  
  - [x] 10.3 感想管理コマンドを拡張
    - edit-impression <book_id>: Markdownエディタで感想を編集
    - _要件: 4.1, 4.3_

- [x] 11. チェックポイント - すべてのテストが成功していることを確認
  - すべてのテストが成功していることを確認し、問題があれば質問してください。

- [x] 12. データ移行機能の実装
  - [x] 12.1 v1からv2へのデータ移行スクリプトを実装
    - v1のbooks.jsonを読み込み
    - 新しいフィールド（cover_url、status）にデフォルト値を設定
    - v1のimpressionsをMarkdownファイルに変換
    - _要件: 6.1, 6.2_
  
  - [x]* 12.2 データ移行のプロパティテストを実装
    - **プロパティ12: v1データの互換性**
    - **検証: 要件6.1**
  
  - [x]* 12.3 データ移行のプロパティテストを実装
    - **プロパティ13: 感想ファイルへの移行**
    - **検証: 要件6.2**
  
  - [x]* 12.4 データ移行のプロパティテストを実装
    - **プロパティ14: 移行後のデータ互換性**
    - **検証: 要件6.3**

- [x] 13. エラーハンドリングの実装
  - [x] 13.1 バーコード読み取りエラーの処理
    - カメラアクセス拒否
    - バーコード認識失敗
    - _要件: 1.4_
  
  - [x] 13.2 Markdownファイル操作エラーの処理
    - ファイル読み書きエラー
    - ファイル破��時の処理
    - _要件: 4.1, 4.3_
  
  - [x] 13.3 書影URL取得エラーの処理
    - APIエラー時のデフォルト画像使用
    - _要件: 3.2_

- [x] 14. チェックポイント - すべてのテストが成功していることを確認
  - すべてのテストが成功していることを確認し、問題があれば質問してください。

- [x] 15. ドキュメント更新
  - [x] 15.1 READMEを更新
    - 新機能の説明
    - バーコード読み取りの使い���
    - ステータス管理の説明
    - Markdown感想の管理方法
    - Webインターフェースの使い方
    - データ移行手順
    - _要件: 1.1, 2.1, 3.1, 4.1, 5.1, 6.1_

- [x] 16. 最終チェックポイント - すべてのテストが成功していることを確認
  - すべてのテストが成功していることを確認し、問題があれば質問してください。
